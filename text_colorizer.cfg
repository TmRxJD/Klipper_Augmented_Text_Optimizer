[gcode_macro text_styler]
gcode:
    {% set msg = namespace() %}
    {% set colored_text = namespace() %}
    {% set message = params.MESSAGE | default("Welcome to the Text Styler!") | string %}
    {% set by_word = params.BY_WORD | default(false) %}
    
    {% set font_colors = params.FONT_COLORS.split(',') if params.TEXT_COLORS is defined else ["primary", "error", "warning", "accent", "success", "secondary", "info"]%}
    {% set bg_colors = params.BG_COLORS.split(',') if params.BG_COLORS is defined else ["black", "yellow", "blue", "green", "red"] %}
    {% set font_sizes = params.FONT_SIZES.split(',') if params.FONT_SIZES is defined else ["16", "20", "14", "22", "12", "18"] %}
    {% set bold = params.BOLD.split(',') if params.BOLD is defined else ["bold", "none"] %}
    {% set italic = params.ITALIC.split(',') if params.ITALIC is defined else ["italic", "none"] %}
    {% set lines = params.LINES.split(',') if params.LINES is defined else ["underline", "strike", "none"] %}
    {% set line_colors = params.LINE_COLORS.split(',') if params.LINE_COLORS is defined else ["red", "blue"] %}
    {% set fonts = params.FONTS.split(',') if params.FONTS is defined else ["Arial", "Times New Roman", "Verdana", "Helvetica", "Gothic"] %}
    {% set opacities = params.OPACITIES.split(',') if params.OPACITIES is defined else ["0.25", "0.5", "0.75", "1"] %}
    {% set border_sizes = params.BORDER_SIZES.split(',') if params.BORDER_SIZES is defined else ["2", "3", "2.5", "1"] %}
    {% set border_colors = params.BORDER_COLORS.split(',') if params.BORDER_COLORS is defined else ["black", "yellow", "blue", "green", "red"] %}
    {% set border_types = params.BORDER_TYPES.split(',') if params.BORDER_TYPES is defined else ["solid", "dotted", "double", "groove", "ridge", "inset", "outset"]%}

    {%- macro style_text(text, font_color, bg_color, font_size, font_style, bold_style, italic_style, line_style, line_color, opacity_style, border_style) -%}
      <span class="{ text_color }--text" style="background:{ bg_color }; font-size:{ font_size }px;{ font_style }{ bold_style }{ italic_style }{ line_style }{ line_color }{ opacity_style }{ border_style }">{ text }</span>
    {%- endmacro %}
  
    {% set msg.out = "" %}
    {% set msg.text_index = 0 %}
    {% set msg.bg_color_index = 0 %}
    {% set msg.font_size_index = 0 %}
    {% set msg.bold_index = 0 %}
    {% set msg.italic_index = 0 %}
    {% set msg.line_index = 0 %}
    {% set msg.line_color_index = 0 %}
    {% set msg.font_index = 0 %}
    {% set msg.opacity_index = 0 %}
    {% set msg.border_size_index = 0 %}
    {% set msg.border_type_index = 0 %}
    {% set msg.border_color_index = 0 %}
    {% set text = message.split() if params.BY_WORD else message %}
  
    {% for chars in text %}
      {% set text = chars | string if params.BY_WORD else chars %}
      {% set font_color = font_colors[msg.font_color_index % font_colors | length] | string %}
      {% set bg_color = bg_colors[msg.bg_color_index % bg_colors | length] | string %}
      {% set font_size = font_sizes[msg.font_size_index % font_sizes | length] | string %}
      {% set bold_setting = bold[msg.bold_index % bold | length] | string %}
      {% set italic_setting = italic[msg.italic_index % italic | length] | string %}
      {% set line_setting = lines[msg.line_index % lines | length] | string %}
      {% set line_color = line_colors[msg.line_color_index % line_colors | length] | string %}
      {% set font = fonts[msg.font_index % fonts | length] | string %}
      {% set opacity = opacities[msg.opacity_index % opacities | length] | string %}
      {% set border_color = border_colors[msg.border_color_index % border_colors | length] | string %}
      {% set border_size = border_sizes[msg.border_size_index % border_sizes | length] | string %}
      {% set border_type = border_types[msg.border_type_index % border_types | length] | string %}
  
      {% set font_style = 'font-family:' + font + ';' %}
      {% set bold_style = 'font-weight:bold;' if bold_setting == 'bold' else '' %}
      {% set italic_style = 'font-style:italic;' if italic_setting == 'italic' else '' %}
      {% set line_color = 'text-decoration-color:' + line_color + ';' %}
      {% set opacity_style = 'opacity:' + opacity + ';' %}
      {% set border_style = 'border: ' + border_size + 'px ' + border_type + ' ' + border_color + ';' %}
      
      {% if line_setting != '' %}
        {% set line_style = 'text-decoration:underline;' if line_setting == 'underline' else 'text-decoration:line-through;' %}
      {% endif %}
              
      {% set colored_text.out = style_text(text, font_color, bg_color, font_size, font_style, bold_style, italic_style, line_style, line_color, opacity_style, border_style) %}
      {% set msg.out = msg.out + colored_text.out %}
      {% set msg.out = msg.out + ' ' if by_word and not loop.last else msg.out %}
  
      {% set msg.text_index = msg.text_index + 1 %}
      {% set msg.bg_color_index = msg.bg_color_index + 1 %}
      {% set msg.font_size_index = msg.font_size_index + 1 %}
      {% set msg.bold_index = msg.bold_index + 1 %}
      {% set msg.italic_index = msg.italic_index + 1 %}
      {% set msg.line_index = msg.line_index + 1 %}
      {% set msg.line_color_index = msg.line_color_index + 1 %}
      {% set msg.font_index = msg.font_index + 1 %}
      {% set msg.opacity_index = msg.opacity_index + 1 %}
      {% set msg.border_size_index = msg.border_size_index + 1 %}
      {% set msg.border_color_index = msg.border_color_index + 1 %}
      {% set msg.border_type_index = msg.border_type_index + 1 %}
    {% endfor %}
  
    { action_respond_info(msg.out) }  
