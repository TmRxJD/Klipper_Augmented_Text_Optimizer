[gcode_macro text_colorizer]
gcode:
  {% set msg = namespace() %}
  {% set colored_text = namespace() %}
  {% set message = params.MESSAGE | default("Welcome to the Text Colorizer!") | string %}
  {% set by_word = params.BY_WORD | default(false) %}

  {% if params.TEXT_COLORS is defined %}
    {% set text_colors = params.TEXT_COLORS.split(',') %}
  {% else %}
    {% set text_colors = ["primary", "error", "warning", "accent", "success", "secondary", "info"] %}
  {% endif %}

  {% if params.BG_COLORS is defined %}
    {% set bg_colors = params.BG_COLORS.split(',') %}
  {% else %}
    {% set bg_colors = ["black", "yellow", "blue", "red", "green"] %}
  {% endif %}
  
  {% set msg.out = "" %}
  {% set msg.text_color_index = 0 %}
  {% set msg.bg_color_index = 0 %}
  
  {% if by_word %}
    {% for words in message.split() %}
      {% set word = words | string %}
      {% set text_color = text_colors[msg.text_color_index % text_colors | length] | string %}
      {% set bg_color = bg_colors[msg.bg_color_index % bg_colors | length] | string %}
      {% set colored_text.out = '<span class="' + text_color + '--text" style="background:' + bg_color +'">' + word + " " + '</span>' | string %}
      {% set msg.out = msg.out + colored_text.out %}
      {% set msg.text_color_index = msg.text_color_index + 1 %}
      {% set msg.bg_color_index = msg.bg_color_index + 1 %}
    {% endfor %}
  {% else %}
    {% for letters in message %}
      {% set letter = letters | string %}
      {% set text_color = text_colors[msg.text_color_index % text_colors | length] | string %}
      {% set bg_color = bg_colors[msg.bg_color_index % bg_colors | length] | string %}
      {% set colored_text.out = '<span class="' + text_color + '--text" style="background:' + bg_color +'">' + letter + '</span>' | string %}
      {% set msg.out = msg.out + colored_text.out %}
      {% set msg.text_color_index = msg.text_color_index + 1 %}
      {% set msg.bg_color_index = msg.bg_color_index + 1 %}
    {% endfor %}
  {% endif %}
  
  { action_respond_info(msg.out) }
